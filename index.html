<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Map Editor</title>
        <style>
    /* 仅做简单示例，可根据需求自行美化 */
    #controls {
      margin: 10px 0;
    }
    #grid {
      display: inline-block;
      /* 防止右键菜单时文本被选中等 */
      user-select: none;
    }
    .row {
      display: flex;
    }
    .cell {
      width: 20px;
      height: 20px;
      border: 1px solid #333;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-family: monospace;
      cursor: pointer;
      /* 让文字不被用户选中 */
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
        </style>
    </head>
    <body>
        <div id="controls">
            行数：
            <input type="number" id="rows" value="30" style="width:60px;">
            列数：
            <input type="number" id="cols" value="30" style="width:60px;">
            <button onclick="generateGrid()">生成网格</button>
            <button onclick="downloadMap()">下载地图</button>
        </div>
        <div id="grid"></div>
        <script>
  let mapData = [];  // 用来存储所有格子的数值(二维数组)

  // 根据输入行数和列数生成网格
  function generateGrid() {
    const rows = parseInt(document.getElementById('rows').value, 10);
    const cols = parseInt(document.getElementById('cols').value, 10);

    const gridContainer = document.getElementById('grid');
    gridContainer.innerHTML = '';  // 先清空已有内容
    mapData = [];

    for (let r = 0; r < rows; r++) {
      // 每行一个数组
      mapData[r] = [];
      const rowDiv = document.createElement('div');
      rowDiv.className = 'row';

      for (let c = 0; c < cols; c++) {
        mapData[r][c] = 0;  // 默认值为0

        const cellDiv = document.createElement('div');
        cellDiv.className = 'cell';
        cellDiv.textContent = '0'; // 显示当前数据

        // 禁止默认的右键菜单
        cellDiv.oncontextmenu = function(e) {
          e.preventDefault();
          return false;
        };

        // 左键点击 - 设置为 1
        cellDiv.addEventListener('click', function(e) {
          mapData[r][c] = 1;
          cellDiv.textContent = '1';
        });

        // 右键点击 - 设置为 2
        cellDiv.addEventListener('contextmenu', function(e) {
          mapData[r][c] = 2;
          cellDiv.textContent = '2';
        });

        rowDiv.appendChild(cellDiv);
      }

      gridContainer.appendChild(rowDiv);
    }
  }

  // 将 mapData 导出成文本，并下载为 output.map
  function downloadMap() {
    // 将二维数组转成每行一个字符串的形式
    const rows = mapData.length;
    const cols = rows > 0 ? mapData[0].length : 0;
    let content = '';

    for (let r = 0; r < rows; r++) {
      let rowString = '';
      for (let c = 0; c < cols; c++) {
        rowString += mapData[r][c].toString();
      }
      content += rowString + '\n';
    }

    // 创建一个 Blob，用于触发下载
    const blob = new Blob([content], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);

    const link = document.createElement('a');
    link.href = url;
    link.download = 'output.map'; // 下载文件名
    link.click();

    // 释放 URL 对象
    URL.revokeObjectURL(url);
  }
        </script>
    </body>
</html>
